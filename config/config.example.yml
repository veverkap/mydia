# Mydia Configuration File (YAML)
# =================================
# Copy this file to config.yml and customize for your environment.
#
# Configuration Precedence:
#   1. Environment variables (highest priority)
#   2. This YAML file
#   3. Application defaults (lowest priority)
#
# Note: Environment variables will override any values set in this file.
# See .env.example for the corresponding environment variable names.

# Server Configuration
# --------------------
server:
  # Port the web server listens on
  port: 4000

  # Host interface to bind to (0.0.0.0 for all interfaces)
  host: "0.0.0.0"

  # URL scheme for generated URLs (http or https)
  url_scheme: "https"

  # Public hostname for the application
  url_host: "mydia.example.com"

  # Secret key base for signing cookies and sessions
  # Generate with: mix phx.gen.secret
  # In production, use environment variable SECRET_KEY_BASE instead
  secret_key_base: "CHANGE_ME_IN_PRODUCTION"

  # Guardian JWT secret key for API authentication
  # Generate with: mix guardian.gen.secret
  # In production, use environment variable GUARDIAN_SECRET_KEY instead
  guardian_secret_key: "CHANGE_ME_IN_PRODUCTION"

# Database Configuration
# ----------------------
database:
  # Path to SQLite database file
  path: "/config/mydia.db"

  # Database connection pool size
  pool_size: 5

  # Query timeout in milliseconds
  # Increased to 60 seconds to handle long-running library scans
  timeout: 60000

  # SQLite cache size in KB (negative means KB, positive means pages)
  cache_size: -64000

  # SQLite busy timeout in milliseconds
  # Increased to 30 seconds to handle concurrent writes during library scans
  busy_timeout: 30000

  # SQLite journal mode (delete, truncate, persist, memory, wal)
  # WAL (Write-Ahead Logging) is recommended for better concurrency
  journal_mode: "wal"

  # SQLite synchronous mode (off, normal, full, extra)
  # 'normal' provides good balance of safety and performance
  synchronous: "normal"

# Authentication Configuration
# ----------------------------
auth:
  # Enable local username/password authentication
  local_enabled: true

  # Enable OIDC (OpenID Connect) authentication
  oidc_enabled: false

  # OIDC issuer URL (e.g., https://auth.example.com/realms/myrealm)
  # Either oidc_issuer or oidc_discovery_document_uri must be set if OIDC is enabled
  oidc_issuer: "https://auth.example.com/realms/myrealm"

  # OIDC discovery document URI (alternative to oidc_issuer)
  # oidc_discovery_document_uri: "https://auth.example.com/.well-known/openid-configuration"

  # OIDC client ID
  oidc_client_id: "mydia"

  # OIDC client secret
  oidc_client_secret: "your-oidc-client-secret"

  # OIDC redirect URI (defaults to {url_scheme}://{url_host}/auth/oidc/callback)
  # oidc_redirect_uri: "https://mydia.example.com/auth/oidc/callback"

  # OIDC scopes to request
  oidc_scopes: "openid profile email"

  # JWT token time-to-live in days
  jwt_ttl_days: 30

  # JWT allowed clock drift in milliseconds
  jwt_allowed_drift: 2000

# Media Library Configuration
# ---------------------------
# Configure your media library paths for automatic scanning and organization.
#
# Basic Configuration (Simple):
# You can use movies_path and tv_path for simple setup with a single path for
# each media type. These paths will be monitored automatically.
#
# Advanced Configuration (library_paths):
# Use the library_paths list below for full control over multiple library paths.
# This allows you to configure all properties including type, monitoring,
# scan interval, and quality profiles.
#
# Note: Paths must exist and be readable by the application at startup.
# The application will validate these paths on startup and log warnings
# for any invalid paths.
media:
  # Path to movies library (legacy - simple configuration)
  # This creates a monitored library path of type "movies"
  movies_path: "/media/movies"

  # Path to TV shows library (legacy - simple configuration)
  # This creates a monitored library path of type "series"
  tv_path: "/media/tv"

  # How often to scan the media library (in hours)
  # This is the default scan interval for library paths
  scan_interval_hours: 1

  # Automatically trigger search & download when adding media to library
  # When true: Adding a movie/show automatically queues a search job
  # When false: Requires manual "Auto Search & Download" button click
  auto_search_on_add: true

  # Enable monitoring by default when adding media to library
  # When true: New items are monitored automatically
  # When false: New items are not monitored (manual enable required)
  monitor_by_default: true

# Advanced Library Paths Configuration
# -------------------------------------
# Configure multiple library paths with full control over all properties.
# These paths are merged with environment variable configurations and the
# legacy movies_path/tv_path settings above.
#
# Note: If you use library_paths, you don't need to set movies_path/tv_path
# unless you want backward compatibility.
library_paths:
  # Example: Movies library
  - path: "/media/movies"
    type: "movies" # Type: movies, series, or mixed
    monitored: true # Enable/disable monitoring
    scan_interval: 3600 # Scan interval in seconds (3600 = 1 hour)
    # quality_profile_id: 1 # Optional: Assign a quality profile

  # Example: TV shows library
  - path: "/media/tv-shows"
    type: "series"
    monitored: true
    scan_interval: 3600

  # Example: Mixed media library (not monitored)
  # - path: "/media/mixed"
  #   type: "mixed"
  #   monitored: false
  #   scan_interval: 7200   # 2 hours

  # Example: 4K Movies library with quality profile
  # - path: "/media/movies-4k"
  #   type: "movies"
  #   monitored: true
  #   scan_interval: 3600
  #   quality_profile_id: 2  # Assign specific quality profile

# Download Configuration
# ----------------------
downloads:
  # How often to monitor downloads for completion (in minutes)
  monitor_interval_minutes: 2

# Logging Configuration
# ---------------------
logging:
  # Log level (debug, info, warning, error)
  level: "info"

  # Log format string (uses Elixir Logger format)
  # format: "[$level] $message\n"

# Oban (Background Jobs) Configuration
# -------------------------------------
oban:
  # How often to poll for jobs (in milliseconds)
  poll_interval: 1000

  # How long to keep completed jobs (in days)
  max_age_days: 7

# Download Clients Configuration
# -------------------------------
# Configure one or more download clients for automated media acquisition.
# Multiple clients can be configured and prioritized for failover.
download_clients:
  # qBittorrent example
  - name: "qBittorrent"
    type: "qbittorrent"
    enabled: true
    priority: 1
    host: "localhost"
    port: 8080
    use_ssl: false
    # Optional: URL base path (e.g., "/qbittorrent" if behind reverse proxy)
    url_base: ""
    username: "admin"
    # In production, use environment variable: DOWNLOAD_CLIENT_1_PASSWORD
    password: "adminpass"
    # Optional: Default category for downloads
    category: "mydia"
    # Optional: Download directory path
    download_directory: "/downloads/complete"

  # Transmission example (commented out)
  # - name: "Transmission"
  #   type: "transmission"
  #   enabled: true
  #   priority: 2
  #   host: "localhost"
  #   port: 9091
  #   use_ssl: false
  #   url_base: "/transmission"
  #   username: "transmission"
  #   password: "transmission"
  #   download_directory: "/downloads"

  # HTTP download client example (commented out)
  # - name: "HTTP Downloader"
  #   type: "http"
  #   enabled: true
  #   priority: 3
  #   host: "localhost"
  #   port: 8081
  #   use_ssl: false
  #   # API key for authentication (if required)
  #   api_key: "your-api-key-here"
  #   download_directory: "/downloads/http"

# Indexer Configuration
# ----------------------
# Configure torrent indexers and search providers for media discovery.
# Supports Prowlarr (aggregator), Jackett (proxy), and direct public indexers.
indexers:
  # Prowlarr example - Indexer aggregator (recommended)
  # Prowlarr provides access to hundreds of indexers through a single API
  - name: "Prowlarr"
    type: "prowlarr"
    enabled: true
    priority: 1
    base_url: "http://localhost:9696"
    # In production, use environment variable: INDEXER_1_API_KEY
    api_key: "your-prowlarr-api-key"
    # Optional: Specific indexer IDs to search (empty = all enabled)
    indexer_ids: []
    # Optional: Category IDs to search (empty = all categories)
    # Common categories: 2000 (Movies), 5000 (TV), 8000 (Other)
    categories: []
    # Optional: Rate limit in requests per minute (default: 60)
    rate_limit: 60
    # Optional: Request timeout in milliseconds (default: 30000)
    timeout: 30000

  # Jackett example (commented out)
  # - name: "Jackett"
  #   type: "jackett"
  #   enabled: true
  #   priority: 2
  #   base_url: "http://localhost:9117"
  #   api_key: "your-jackett-api-key"
  #   indexer_ids: []
  #   categories: []
  #   rate_limit: 60
  #   timeout: 30000

  # Public indexer example (commented out)
  # - name: "Public Indexer"
  #   type: "public"
  #   enabled: true
  #   priority: 3
  #   base_url: "https://example-indexer.com"
  #   # API key may not be required for public indexers
  #   categories: []
  #   rate_limit: 30
  #   timeout: 30000
